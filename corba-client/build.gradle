version = '0.0'

apply plugin: 'java'
sourceCompatibility = 1.7

tasks.withType(Compile) {
    options.encoding = 'UTF-8'
}

dependencies {
    compile project(':core')
    compile project(':shell')
    compile project(':corba-server')
    
    compile 'org.springframework:spring-context:3.2.4.RELEASE'
}

repositories {
    mavenCentral()
}

apply plugin:'application'
startScripts {
    mainClassName = "cyberwaste.kuzoff.corba.client.CorbaClientManager"
    classpath.add(files { file("lib/rmic.jar") })
    
    doLast {
        unixScript.text = unixScript.text.replace('DEFAULT_JVM_OPTS=""', 'DEFAULT_JVM_OPTS="-Djava.naming.factory.initial=com.sun.jndi.cosnaming.CNCtxFactory -Djava.naming.provider.url=iiop://localhost:1060"')
    }
}

task rmiJar(type:Exec, dependsOn: ":corba-server:rmiJar") {
    commandLine 'cp', '../corba-server/build/install/corba-server/lib/rmic.jar', "$buildDir/install/$project.name/lib"
}
rmiJar.dependsOn installApp

task installCorbaApp
installCorbaApp.dependsOn rmiJar

task orbd(type:Exec) {
    commandLine 'sh', 'src/main/scripts/orbd', '&'
}
